# language setting
language: none

pre_ci:
      - docker build -t $SHIPPABLE_CONTAINER_NAME:latest
build:
    post_ci:
      - sudo pip install -U docker-compose awscli
      - docker commit $SHIPPABLE_CONTAINER_NAME 791778434480.dkr.ecr.us-east-1.amazonaws.com/openbridge/php-fpm:latest
      - docker push 791778434480.dkr.ecr.us-east-1.amazonaws.com/openbridge/php-fpm:latest
      - docker-compose up -d
      - docker ps
      - (echo >/dev/tcp/0.0.0.0/9000) &>/dev/null && echo "TCP port 9000 open" && exit 0 || echo "TCP port 9000 close" && exit 1

integrations:
  hub:
    - integrationName: shippable-aws-ecr
      type: ecr
